# =============================================================================
# CONFIGURATION ARCHITECTURE DDD/CQRS AVEC IA DE VEILLE
# =============================================================================

# Configuration Play Framework
play {
  # Modules personnalisés pour injection dépendances
  modules {
    #enabled += "modules.CoreModule"
   # enabled += "modules.PersistenceModule"
   # enabled += "modules.ApplicationModule"
   # enabled += "modules.SecurityModule"
   # enabled += "modules.AiMonitoringModule"
  }
  
  # Configuration sécurité
  http {
    secret.key = "changeme-in-production-this-is-not-secure"
    session.cookieName = "BREWING_ADMIN_SESSION"
    session.maxAge = 3600000  # 1 heure
  }
  
  # Filtres sécurité
  filters {
    enabled += "play.filters.csrf.CSRFFilter"
    enabled += "play.filters.headers.SecurityHeadersFilter"
    enabled += "play.filters.hosts.AllowedHostsFilter"
  }
  
  # Configuration CSRF
  filters.csrf {
    header.bypassHeaders {
      X-Requested-With = "*"
      Csrf-Token = "nocheck"
    }
  }
}

# =============================================================================
# BASE DE DONNÉES POSTGRESQL
# =============================================================================

# Configuration évolutions base de données

# =============================================================================
# CONFIGURATION SÉCURITÉ
# =============================================================================
security {
  # Configuration admin
  admin {
    session.timeout = 3600000  # 1 heure
    max.login.attempts = 5
    lockout.duration = 900000  # 15 minutes
  }
  
  # Rate limiting
  rate.limiting {
    enabled = true
    api.public.requests.per.minute = 100
    api.admin.requests.per.minute = 200
  }
  
  # Configuration audit
  audit {
    enabled = true
    retention.days = 365
    sensitive.fields = ["password", "email", "ip"]
  }
}

# =============================================================================
# CONFIGURATION CACHE ET PERFORMANCE  
# =============================================================================
cache {
  # Cache référentiels (styles, origines, arômes)
  referentials.ttl = 3600  # 1 heure
  
  # Cache houblons/ingrédients 
  ingredients.ttl = 1800   # 30 minutes
  
  # Cache propositions IA
  proposals.ttl = 300      # 5 minutes
}

# =============================================================================
# CONFIGURATION LOGGING
# =============================================================================
logger {
  root = WARN
  play = INFO
  application = DEBUG
  
  # Loggers spécialisés
  ai.monitoring = DEBUG
  security = INFO
  audit = INFO
  slick = INFO
}

# =========================
# My-brew-app-V2 (Play 2.9)
# =========================

# --- Modules
play.modules.enabled += "modules.BindingsModule"
play.modules.enabled += "play.api.db.slick.SlickModule"

# --- Filtres & Sécurité
play.filters.enabled += "play.filters.gzip.GzipFilter"
play.filters.enabled += "play.filters.headers.SecurityHeadersFilter"

# ⚠️ CSP en UNE SEULE LIGNE (pas de triple quotes)
play.filters.headers.contentSecurityPolicy = "default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; font-src 'self' data:; connect-src 'self'; frame-ancestors 'self'; base-uri 'self'; form-action 'self'"

# Hôtes (dev). En prod, remplace par ton FQDN.
play.filters.hosts.allowed = ["."]
# ex prod :
# play.filters.hosts.allowed = ["hopfinder.example.com"]

# --- DB (Slick + Hikari)

# Configuration du pool de connexions

logger.slick.jdbc.JdbcBackend.statement=DEBUG
# =============================================================================
# CONFIGURATION BASE DE DONNÉES SLICK - CORRIGÉE
# =============================================================================
slick.dbs.default {
  profile = "slick.jdbc.PostgresProfile$"
  db {
    driver = "org.postgresql.Driver"
    url = "jdbc:postgresql://localhost:5432/appli_brassage"
    user = "postgres"
    password = "postgres"
    numThreads = 10
    maxConnections = 10
    minConnections = 1
    connectionTimeout = 30000
    idleTimeout = 600000
    maxLifetime = 1800000
  }
}

# Configuration Play pour évolutions
play.evolutions.db.default {
  enabled = true
  autoApply = true
  autoApplyDowns = false
}
play.evolutions.enabled = false

# =============================================================================
# DÉSACTIVATION ÉVOLUTIONS PLAY (pour tests manuels BDD)
# =============================================================================
play.evolutions.enabled = false
play.evolutions.autoApply = false
play.evolutions.autoApplyDowns = false
play.evolutions.db.default.enabled = false
play.evolutions.db.default.autoApply = false


# Module domaine Malts

# Module domaine Malts (séparé)
play.modules.enabled += "modules.MaltsModule"
